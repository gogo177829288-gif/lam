<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LAMPPOLI ‚Äî Enter the Unknown</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Orbitron:wght@400;700;900&family=Noto+Sans+JP:wght@300;400;700&display=swap');
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      background: #ffffff;
      min-height: 100vh;
      overflow: hidden;
      font-family: 'Orbitron', sans-serif;
      color: #1a1a1a;
    }
    
    #canvas-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
    }
    
    /* Sakura Petals */
    .sakura-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 15;
      overflow: hidden;
    }
    
    .sakura {
      position: absolute;
      top: -50px;
      animation: fall linear infinite;
    }
    
    .sakura::before {
      content: '';
      display: block;
      width: var(--size);
      height: var(--size);
      background: linear-gradient(135deg, #ffb7c5 0%, #ff69b4 50%, #ffb7c5 100%);
      border-radius: 50% 0 50% 50%;
      transform: rotate(45deg);
      opacity: 0.8;
      box-shadow: 0 0 10px rgba(255, 183, 197, 0.5);
    }
    
    @keyframes fall {
      0% {
        transform: translateY(-10vh) rotate(0deg) translateX(0);
        opacity: 1;
      }
      25% {
        transform: translateY(25vh) rotate(90deg) translateX(20px);
      }
      50% {
        transform: translateY(50vh) rotate(180deg) translateX(-20px);
      }
      75% {
        transform: translateY(75vh) rotate(270deg) translateX(20px);
      }
      100% {
        transform: translateY(110vh) rotate(360deg) translateX(-10px);
        opacity: 0.3;
      }
    }
    
    /* Soft gradient overlay */
    .gradient-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(ellipse at 50% 100%, rgba(255, 183, 197, 0.2) 0%, transparent 50%),
        radial-gradient(ellipse at 0% 0%, rgba(255, 218, 233, 0.15) 0%, transparent 40%),
        radial-gradient(ellipse at 100% 0%, rgba(255, 218, 233, 0.15) 0%, transparent 40%);
      pointer-events: none;
      z-index: 2;
    }
    
    /* Title - positioned at bottom */
    .title {
      position: fixed;
      bottom: 15%;
      left: 50%;
      transform: translateX(-50%);
      text-align: center;
      z-index: 20;
      pointer-events: none;
    }
    
    .title h1 {
      font-family: 'Bebas Neue', sans-serif;
      font-size: clamp(2.5rem, 10vw, 7rem);
      letter-spacing: 0.15em;
      color: #2a2a2a;
      text-shadow: 
        0 0 40px rgba(255, 150, 180, 0.3),
        0 2px 10px rgba(0, 0, 0, 0.1);
    }
    
    .title .subtitle {
      font-family: 'Noto Sans JP', sans-serif;
      font-size: clamp(0.5rem, 1.5vw, 0.8rem);
      letter-spacing: 0.4em;
      color: rgba(100, 100, 100, 0.7);
      margin-top: 0.5rem;
      font-weight: 300;
    }
    
    .title .jp-text {
      font-family: 'Noto Sans JP', sans-serif;
      font-size: clamp(0.7rem, 1.5vw, 1rem);
      color: #ffb7c5;
      margin-bottom: 0.3rem;
      letter-spacing: 0.3em;
    }
    
    /* Corner UI */
    .corner-ui {
      position: fixed;
      z-index: 30;
      font-size: 0.5rem;
      color: rgba(150, 150, 150, 0.6);
      letter-spacing: 0.15em;
      pointer-events: none;
    }
    
    .corner-ui.top-left { top: 2rem; left: 2rem; }
    .corner-ui.top-right { top: 2rem; right: 2rem; text-align: right; }
    .corner-ui.bottom-left { bottom: 2rem; left: 2rem; }
    .corner-ui.bottom-right { bottom: 2rem; right: 2rem; text-align: right; }
    
    .corner-ui .value {
      color: #ffb7c5;
      display: block;
      margin-top: 0.3rem;
    }
    
    /* CTA */
    .cta {
      position: fixed;
      bottom: 5%;
      left: 50%;
      transform: translateX(-50%);
      z-index: 30;
      padding: 0.8rem 2.5rem;
      background: rgba(255, 183, 197, 0.15);
      border: 1px solid rgba(255, 150, 180, 0.4);
      color: #555;
      font-family: 'Orbitron', sans-serif;
      font-size: 0.6rem;
      letter-spacing: 0.3em;
      cursor: pointer;
      transition: all 0.4s;
      backdrop-filter: blur(10px);
      border-radius: 2px;
    }
    
    .cta:hover {
      background: rgba(255, 183, 197, 0.3);
      border-color: #ffb7c5;
      color: #333;
      box-shadow: 0 0 30px rgba(255, 150, 180, 0.3);
      transform: translateX(-50%) scale(1.05);
    }
    
    /* Loading */
    .loading {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #ffffff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      transition: opacity 1s, visibility 1s;
    }
    
    .loading.hidden {
      opacity: 0;
      visibility: hidden;
    }
    
    .loading-text {
      font-size: 0.9rem;
      letter-spacing: 0.5em;
      color: #ffb7c5;
      animation: loadingPulse 1.5s ease-in-out infinite;
    }
    
    .loading-sakura {
      font-size: 2rem;
      margin-bottom: 1rem;
      animation: loadingSpin 2s linear infinite;
    }
    
    @keyframes loadingPulse {
      0%, 100% { opacity: 0.5; }
      50% { opacity: 1; }
    }
    
    @keyframes loadingSpin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    
    /* Instructions */
    .instructions {
      position: fixed;
      top: 2rem;
      left: 50%;
      transform: translateX(-50%);
      z-index: 25;
      font-size: 0.5rem;
      color: rgba(150, 150, 150, 0.4);
      letter-spacing: 0.2em;
      pointer-events: none;
    }
  </style>
</head>
<body>
  
  <!-- Loading Screen -->
  <div class="loading" id="loading">
    <div class="loading-sakura">üå∏</div>
    <div class="loading-text">LOADING...</div>
  </div>
  
  <!-- 3D Canvas -->
  <div id="canvas-container"></div>
  
  <!-- Gradient Overlay -->
  <div class="gradient-overlay"></div>
  
  <!-- Sakura Petals -->
  <div class="sakura-container" id="sakura-container"></div>
  
  <!-- Instructions -->
  <div class="instructions">DRAG TO ROTATE ‚Ä¢ SCROLL TO ZOOM</div>
  
  <!-- Title at bottom -->
  <div class="title">
    <p class="jp-text">Ê°ú„ÅÆÁâ©Ë™û</p>
    <h1>LAMPPOLI</h1>
    <p class="subtitle">Enter the Unknown</p>
  </div>
  
  <!-- Corner UI -->
  <div class="corner-ui top-left">
    STATUS<br>
    <span class="value">‚óè ONLINE</span>
  </div>
  <div class="corner-ui top-right">
    SEASON<br>
    <span class="value">01</span>
  </div>
  <div class="corner-ui bottom-left">
    VER 1.0.0
  </div>
  <div class="corner-ui bottom-right">
    2026
  </div>
  
  <!-- CTA -->
  <button class="cta" onclick="alert('Stories coming soon!')">BEGIN JOURNEY</button>

  <!-- Three.js and VRM -->
  <script type="importmap">
  {
    "imports": {
      "three": "https://cdn.jsdelivr.net/npm/three@0.154.0/build/three.module.js",
      "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.154.0/examples/jsm/",
      "@pixiv/three-vrm": "https://cdn.jsdelivr.net/npm/@pixiv/three-vrm@2.0.6/lib/three-vrm.module.min.js"
    }
  }
  </script>
  
  <script type="module">
    import * as THREE from 'three';
    import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
    import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
    import { VRMLoaderPlugin, VRMUtils } from '@pixiv/three-vrm';
    
    // Create Sakura Petals
    const sakuraContainer = document.getElementById('sakura-container');
    const petalCount = 50;
    
    for (let i = 0; i < petalCount; i++) {
      const petal = document.createElement('div');
      petal.className = 'sakura';
      
      const size = Math.random() * 12 + 8;
      const left = Math.random() * 100;
      const duration = Math.random() * 8 + 8;
      const delay = Math.random() * 10;
      
      petal.style.cssText = `
        --size: ${size}px;
        left: ${left}%;
        animation-duration: ${duration}s;
        animation-delay: ${delay}s;
      `;
      
      sakuraContainer.appendChild(petal);
    }
    
    // Scene setup
    const container = document.getElementById('canvas-container');
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0xffffff);
    
    // Camera
    const camera = new THREE.PerspectiveCamera(30, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.set(0, 1.2, 4);
    
    // Renderer
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    renderer.outputEncoding = THREE.sRGBEncoding;
    renderer.toneMapping = THREE.ACESFilmicToneMapping;
    renderer.toneMappingExposure = 1.2;
    container.appendChild(renderer.domElement);
    
    // Controls
    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.05;
    controls.minDistance = 2;
    controls.maxDistance = 6;
    controls.target.set(0, 1, 0);
    controls.maxPolarAngle = Math.PI / 1.8;
    controls.minPolarAngle = Math.PI / 4;
    controls.update();
    
    // Lights
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
    scene.add(ambientLight);
    
    const mainLight = new THREE.DirectionalLight(0xffffff, 1.0);
    mainLight.position.set(1, 1, 1).normalize();
    scene.add(mainLight);
    
    const fillLight = new THREE.DirectionalLight(0xffeeff, 0.5);
    fillLight.position.set(-1, 1, -1).normalize();
    scene.add(fillLight);
    
    const rimLight = new THREE.DirectionalLight(0xffccdd, 0.4);
    rimLight.position.set(0, 1, -1).normalize();
    scene.add(rimLight);
    
    // Mouse tracking
    let mouseX = 0;
    let mouseY = 0;
    document.addEventListener('mousemove', (e) => {
      mouseX = (e.clientX / window.innerWidth) * 2 - 1;
      mouseY = -(e.clientY / window.innerHeight) * 2 + 1;
    });
    
    // Load VRM model
    let currentVrm = null;
    let blinkTimer = 0;
    let isBlinking = false;
    let nextBlinkTime = 3 + Math.random() * 2;
    
    const loader = new GLTFLoader();
    
    loader.register((parser) => {
      return new VRMLoaderPlugin(parser);
    });
    
    loader.load(
      'elysia.vrm',
      (gltf) => {
        const vrm = gltf.userData.vrm;
        
        if (vrm) {
          currentVrm = vrm;
          
          VRMUtils.removeUnnecessaryJoints(vrm.scene);
          VRMUtils.removeUnnecessaryVertices(vrm.scene);
          
          vrm.scene.rotation.y = Math.PI;
          
          scene.add(vrm.scene);
          
          console.log('VRM loaded!');
          console.log('Expressions:', vrm.expressionManager?.expressionMap);
        }
        
        setTimeout(() => {
          document.getElementById('loading').classList.add('hidden');
        }, 500);
      },
      (progress) => {
        if (progress.total > 0) {
          const percent = (progress.loaded / progress.total * 100).toFixed(0);
          document.querySelector('.loading-text').textContent = `LOADING... ${percent}%`;
        }
      },
      (error) => {
        console.error('Error loading VRM:', error);
        document.querySelector('.loading-text').textContent = 'ERROR LOADING MODEL';
      }
    );
    
    // Animation
    const clock = new THREE.Clock();
    
    function animate() {
      requestAnimationFrame(animate);
      
      const delta = clock.getDelta();
      const elapsed = clock.elapsedTime;
      
      if (currentVrm) {
        // Update VRM
        currentVrm.update(delta);
        
        // === BREATHING / IDLE ANIMATION ===
        // Gentle up-down floating (breathing)
        currentVrm.scene.position.y = Math.sin(elapsed * 0.8) * 0.02;
        
        // Subtle body sway side to side
        currentVrm.scene.rotation.z = Math.sin(elapsed * 0.5) * 0.01;
        
        // Very slow idle rotation
        currentVrm.scene.rotation.y = Math.PI + Math.sin(elapsed * 0.3) * 0.08;
        
        // === LOOK AT CURSOR ===
        if (currentVrm.lookAt) {
          const targetX = mouseX * 1.5;
          const targetY = 1 + mouseY * 0.3;
          currentVrm.lookAt.target.set(targetX, targetY, 2);
        }
        
        // === BLINKING ===
        blinkTimer += delta;
        
        // Start blink
        if (!isBlinking && blinkTimer > nextBlinkTime) {
          isBlinking = true;
          blinkTimer = 0;
        }
        
        // Blink animation
        if (isBlinking && currentVrm.expressionManager) {
          const blinkDuration = 0.15;
          const blinkProgress = blinkTimer / blinkDuration;
          
          if (blinkProgress < 1) {
            // Smooth blink curve
            const blinkValue = Math.sin(blinkProgress * Math.PI);
            currentVrm.expressionManager.setValue('blink', blinkValue);
          } else {
            // Blink finished
            currentVrm.expressionManager.setValue('blink', 0);
            isBlinking = false;
            blinkTimer = 0;
            nextBlinkTime = 2 + Math.random() * 4; // Random 2-6 seconds until next blink
          }
        }
      }
      
      controls.update();
      renderer.render(scene, camera);
    }
    animate();
    
    // Resize
    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
  
</body>
</html>
